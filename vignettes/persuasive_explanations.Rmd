---
title: "Get a persuasive explanation of the output of a classifier"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Get a persuasive explanation of the output of a classifier}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
bibliography: references.bib
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup}
library(bncounterfactuals)
```

# Persuasive Explanations

Persuasive explanations of a classifier output given an input $X$ are a tuple $<S,C>$, where $S$ is a set of **sufficient explanations** and $C$ is a set of **counterfactual** explanations. **Sufficient explanations** are subsets of the explanatory variables such that, if they have the same values as in the original input $X$, the output of the classifier will remain the same regardless of the value of the rest of the variables. **Counterfactual explanations** are the opposite: value assignations to a subset of the explanatory variables such that, if they all have different values from the original assignation in $X$, and the other variables remain with the same value, the output changes.

### BFS_SFX

BFS_SFX [@koopman2021persuasive] is an algorithm to find sufficient explanations for the output of a Bayesian Network, but may also be used for almost any classifier. Below is a use example, where two sufficient explanations are obtained for the output "Fallot". The interpretation of the second explanation for example, is that if (LVHReport="yes", LowerBodyO2="5-12", XrayReport="Oligaemic"), the prediction is "Fallot" regardless of the value of CO2Report.

```{r}
library(bnlearn)
set.seed(40)
download.file("https://www.bnlearn.com/bnrepository/child/child.rda",
              "child.rda", "auto", quiet = TRUE)
load("child.rda")  # Load CHILD Bayesian Network
evidence = data.frame(
  LVHReport=factor(x = "yes", levels = dimnames(bn$LVHreport$prob)[[1]]),
  LowerBodyO2=factor(x = "5-12", levels = dimnames(bn$LowerBodyO2$prob)[[1]]),
  CO2Report=factor(x = "<7.5", levels = dimnames(bn$CO2Report$prob)[[1]]),
  XrayReport=factor(x = "Oligaemic", levels = dimnames(bn$XrayReport$prob)[[1]])
)
target <- predict(object = bn, node = bn$Disease$node, data = evidence,
                 method = "bayes-lw")
print("Classification input (see dataframe):")
print(evidence)
print("Classification output:")
print(target)
expected <- factor("PAIVS", levels = levels(target))
print("Expected output was:")
print(expected)
predict_f <- function(df) {
  predict(object = bn, node = bn$Disease$node, data = df, method = "bayes-lw")}
print("Sufficient explanation for the output:")
print(bfs_sfx(predict_f, evidence, target, expected))
```
